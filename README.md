Code Ready Containers Quick Loan Bank Demo
==========================================
This demo project showcases the tooling available in Red Hat Decision Manager implementing 
complex decision logic which can be exposed as a decision service. The Quick Loan Bank in this 
demo uses technical rules, decision tables, guided rules with a Domain Specific Language, and 
Excel decision tables to define its loan calculation and approval system.

You will be given examples of calling the rules as if using them from an application through 
the RestAPI that is exposed by the server. Furthermore, this demo provides a Node.js client 
application written in AngularJS and PatternFly that showcases how web applications can 
consume decision services deployed on the decision server.

This demo installs the Red Hat Decision Manager on OpenShift Container Platform on your local
machine. It's leveraging CodeReady Continers and delivers a fully functioning container-native 
development experience.


Install on Code Ready Containers 
--------------------------------
There are two options to install and run this project on the OpenShift Container Platform (OCP); use your own existing installation
or to install on CodeReady Containers which provides you with a local OCP cluster.

1. Ensure you have a CodeReady Containers installation:

  - your own CodeReady Containers installation, if using this you just need to set the variables to point to it in init.{sh|bat} script.

  - [CodeReady Containers Easy Install](https://gitlab.com/redhatdemocentral/ocp-install-demo)

2. [Download and unzip this demo.](https://gitlab.com/redhatdemocentral/crc-quick-loan-bank-demo/-/archive/master/crc-quick-loan-bank-demo-master.zip)

3. Run 'init.sh' or 'init.bat' file. 'init.bat' must be run with Administrative privileges:

```
   # If using your own installation just point to your CodeReady Containers IP address
   # as follows:
   #
   $ ./init.sh 192.168.99.100  # example for CRC.
```

```
   # If using the CodeReady Containers installation, just ensure a correctly set cluster 
   # address for the HOST_IP variable found at the top of the init.{sh|bat} files, for example:
   #
   # HOST_IP=api.crc.testing  
   # 
   # Now just run the script without any IP address arguments and it picks up that hostname as follows:
   #
   $ ./init.sh
```

Now log in to Red Hat Decision Manager to start developing containerized process automation projects (the address will be generated by OCP):

  - CodeReady Container example: https://crc-quick-loan-bank-demo-appdev-in-cloud.apps-crc.testing ( u:erics / p:redhatdm1! )

Not sure how to get started with Red Hat Decision Manager? Try one of these <a href="https://bpmworkshop.gitlab.io/#/4" target="_blank">online workshops</a> to build a first project from scratch.

Running the demo
----------------
1. Click on the "loan-application" project to open the Loan Application Demo project.

2. The project has simple data model (Loan & Applicant) and single decision table (loan-application) which contains the 
   loan approval rule set.

3. Build and deploy version 1.0 of the project. Click on the "Build and Deploy" in the upper right corner.

4. Go to "Menu -> Deploy -> Execution Servers" repository to see the loan-application_1.0 KIE Container deployed on the 
   Decision Server.

5. The decision server provides a Swagger UI that documents the full RESTful interface exposed by the server 
   at: http://localhost:8080/kie-server/docs

6. In the Swagger UI:
   - navigate to "KIE Server and KIE containers"
   - expand the "GET" operation for resource "/server/containers"
   - click on "Try it out"
   - leave the parameters blank and click on "Execute"
   - when asked for credentials use: Username: kieserver, Password: kieserver1!
   - observe the response, which lists the KIE Containers deployed on the server and their status (STARTED, STOPPED).

7. We can use the Swagger UI to test our Loan Approval Decision Service. In the Swagger UI:
   - navigate to "KIE session assets"
   - expand the "POST" operation for resource "/server/containers/instances/{id}"
   - click on "Try it out"
   - set the "id" parameter to the name of the KIE Container that hosts our rules, in this case `loan-application_1.0`.
   - set "Parameter content type" to `application/json`.
   - set "Response content type" to `application/json`
   - use the following request as the "body" parameter. Note that the `Loan` object has its `approved` attribute set to `false`:
   ```
   {
      "lookup": "default-stateless-ksession",
      "commands": [
         {
            "insert": {
               "object": {
                  "com.redhat.demo.qlb.loan_application.model.Applicant": {
                     "creditScore":410,
                     "name":"Billy Bob",
                     "age":40,
                     "yearlyIncome":90000
                  }
               },
               "out-identifier":"applicant"
            }
         },
         {
            "insert": {
               "object": {
                  "com.redhat.demo.qlb.loan_application.model.Loan": {
                     "amount":250000,
                     "duration":10
                  }
               },
               "out-identifier":"loan"
            }
         },
         {
            "start-process" : {
               "processId" : "loan-application.loan-application-decision-flow",
               "parameter" : [ ],
               "out-identifier" : null
            }
         }
      ]
   }
   ```
   - observe the result. The Quick Loan Bank rules have fired and determined that, based on the credit score of the 
     application, and the amount of the loan, the loan can be approved. The `approved` attribute of the `Loan` has been 
     set to `true`.


Running demo with frontend UI
-----------------------------
1. Navigate to the *support/application-ui/* directory. The installation should have built the UI, but if not, manually 
run the command `npm install` to install the required modules. Start the client application by running `npm start`. This 
will start the NodeJS HTTP server and open the Quick Loan Bank client application in your browser (http://localhost:3000). 
Try to submit a new loan request using the same data as shown the JSON file at above. Try to enter different values to 
see a loan get disapproved, for example, change above applicant age from 40 to 80 for rejectoin based on age.

2. You can change the various rules as desired, change the version of the project, and redeploy a new version to a new 
KIE Container (allowing you to serve multiple versions of the same rule set at the same time on the same decision server). 
You can also build a new version of the project and use the Version Configuration tab of the container definition (in the 
Execution Servers screen) to manage the container using the UPGRADE button to pull the new version.



Notes:
-----
If for any reason the installation breaks or you want a new Red Hat Decision Manager installation, just remove the project appdev-in-cloud entry in the OpenShift console and re-run the installation.


Supporting Articles
-------------------
- [TBD]()



Released versions
-----------------
See the tagged releases for the following versions of the product:

- v1.0 - Supporting CodeReady Container 1.15.0 with OpenShift Container Platform 4.5 using Red Hat Decision Manager 7.7 and Node.js provided container
  images to automatically install the Quick Loan Bank demo.

![OCP build app](https://gitlab.com/redhatdemocentral/rhcs-rhdm-install-demo/raw/master/docs/demo-images/rhdm-build-app.png)

![OCP build kieserver](https://gitlab.com/redhatdemocentral/rhcs-rhdm-install-demo/raw/master/docs/demo-images/rhdm-build-kieserver.png)

![OCP build rhdmauthor](https://gitlab.com/redhatdemocentral/rhcs-rhdm-install-demo/raw/master/docs/demo-images/rhdm-build-rhdmauthor.png)

![RHDM OCP app](https://gitlab.com/redhatdemocentral/rhcs-rhdm-install-demo/raw/master/docs/demo-images/rhdm-ocp-app.png)

![RHDM OCP](https://gitlab.com/redhatdemocentral/rhcs-rhdm-install-demo/raw/master/docs/demo-images/rhdm-ocp.png)

